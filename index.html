<html>
<head>
<title>Le bon forfait communauto</title>
<script type="text/javascript" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.3.0/pure-min.css">
<link rel="stylesheet" href="style.css">
<script type="text/javascript">
$(document).ready(function(){
  $("form input,select").on('change',function(){
    var weekday = getInt($('#weekday option:selected').val());
    var hours = getInt($('#hours').val());
    var km = getInt($('#km').val());
    var $plan = $('#plan option:selected');

    // Compute & show long distance
    ld = computeLongDistance(Math.ceil(hours / 24), km);
    $('#lg-time').text(ld.time.toFixed(2) +" $");
    $('#lg-distance').text(ld.distance.toFixed(2) +" $");
    $('#lg-total').text(ld.total.toFixed(2) +" $");

    // Compute & show short distance
    sd = computeShortDistance(hours, km, weekday, $plan)
    $('#sd-time').text(sd.time.toFixed(2) +" $");
    $('#sd-distance').text(sd.distance.toFixed(2) +" $");
    $('#sd-total').text(sd.total.toFixed(2) +" $");
  })

  function getInt(str) {
    return parseInt(str) || 0;
  }

  function computeShortDistance(hours, km, weekday, $plan){
    var hourly_price = parseFloat($plan.data('hourly-price'));
    var daily_price = parseFloat($plan.data('daily-price'));
    var km_price = parseFloat($plan.data('km-price'));
    var days = 0;

    // Extra cost for weekend
    if(weekday >= 4) {
      hourly_price += 0.5; // @todo +1 for plan lapin
      daily_price += 5;
    }

    // Daily cost
    if(hours > 24) {
      days = hours - (hours % 24) / 24;
      hours = hours % 24;
    }

    time_cost = (daily_price * days) + (hourly_price * hours);
    km_cost = km_price * km;

    return {
      time: time_cost,
      distance: km_cost,
      total: time_cost + km_cost
    };
  }

  function computeLongDistance(days, km){
    var daily_price = 24.99;
    var base_km_price = 0.16;
    var extra_km_price = 0.13;
    var extra_offset = 300;

    // @todo compute week cost
    days_cost = days * daily_price;
    km_cost = base_km_price * (km > extra_offset ? extra_offset : km);
    km_cost += base_km_price * (km > extra_offset ? km - extra_offset : 0);

    return {
      time: days_cost,
      distance: km_cost,
      total: days_cost + km_cost
    };
  }
});
</script>
</head>
<body>
  <div class="pure-g-r" id="layout">
    <header class="pure-u">
      <hgroup>
        <h1 class="brand-title">Communauto</h1>
        <h2 class="brand-tagline">Trouvez le bon prix</h2>
      </hgroup>
    </header>

    <div class="pure-u-1">
      <div class="content">
        <!-- A wrapper for all the blog posts -->
        <div class="posts">

          <form class="pure-form pure-form-stacked">
            <fieldset>
              <h2>Vos données</h2>

              <label for="weekday">Jour (plus cher jeudi au dimanche)</label>
              <select id="weekday">
                <option value="1">Lundi</option>
                <option value="2">Mardi</option>
                <option value="3">Mercredi</option>
                <option value="4">Jeudi</option>
                <option value="5">Vendredi</option>
                <option value="6">Samedi</option>
                <option value="7">Dimanche</option>
              </select>

              <label for="hours">Heures</label>
              <input id="hours" type="text" placeholder="2">

              <label for="km">KM</label>
              <input id="km" type="text" placeholder="25">

              <label for="plan">Forfait</label>
              <select id="plan">
                <option value="1"
                  data-km-price="0.23"
                  data-hourly-price="1.50"
                  data-daily-price="15.0">A</option>
                <option value="2"
                  data-km-price="0.32"
                  data-hourly-price="1.75"
                  data-daily-price="17.5">B</option>
                <option value="3"
                  selected="selected"
                  data-km-price="0.39"
                  data-hourly-price="2.00"
                  data-daily-price="20.0">C</option>
                <option value="4"
                  data-km-price="0.15"
                  data-hourly-price="4.95"
                  data-daily-price="49.5">Lièvre</option>
              </select>
            </fieldset>
          </form>

          <h2>Le meilleur forfait</h2>

          <table class="pure-table">
            <thead>
              <tr>
                <th>Coût</th>
                <th>Courte</th>
                <th>Longue</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th>Temps</th>
                <td id="sd-time"></td>
                <td id="lg-time"></td>
              </tr>
              <tr>
                <th>KM</th>
                <td id="sd-distance"></td>
                <td id="lg-distance"></td>
              </tr>
              <tr>
                <th>Total</th>
                <td id="sd-total"></td>
                <td id="lg-total"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <footer class="footer">
          <a href="http://github.com/j15e/communauto">Améliorez ou ajustez le calcul ICI</a> -
          Conçu par <a href="http://j15e.com">Jean-Philippe Doyle</a> pour ma copine.
        </footer>
      </div>
    </div>
  </div>
</body>
</html>